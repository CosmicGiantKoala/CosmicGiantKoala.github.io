{{ define "main" }}
    {{ $landingData := readFile "data/landing.yaml" | transform.Unmarshal }}
    {{ $map := newScratch }}

    {{ range $key, $value := $landingData }}
        {{ $sectionTitle := (index $key) }}
        {{ $weight := string ($value.weight) }}
        {{ $template := string (replaceRE `( |-{1,})` "_" $value.template) }}
        {{ with and $template $weight }}
            {{ $map.SetInMap "wgtTpl" $sectionTitle (dict
            "weight" $weight
            "template" $template
            "sectionTitle" $sectionTitle
            )}}
        {{ end }}
    {{ end }}

    <canvas id="stars" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1;"></canvas>
    <img id="floating-koala" src="{{ resources.Get "images/GiantKoala.png" | relURL }}" alt="Giant Koala">

    {{ range sort ($map.Get "wgtTpl") ".weight" }}
        {{ $.Scratch.Set "sectionTitle" .sectionTitle }}
        {{ $path := printf "landing/%s.html" .template }}
        {{ partial $path $.Page }}
    {{ end }}
    {{/* printf "%s" (sort ($map.Get "wgtTpl") ".weight" ) */}}

    <script>
        const canvas = document.getElementById('stars');
        const ctx = canvas.getContext('2d');
        let stars = [];
        const numStars = Math.floor(Math.random() * 50) + 50; // 50-100

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        function createStars() {
            stars = [];
            for (let i = 0; i < numStars; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: Math.random() * 2 + 0.5,
                    opacity: Math.random(),
                    twinkleSpeed: Math.random() * 0.02 + 0.01,
                    direction: Math.random() > 0.5 ? 1 : -1
                });
            }
        }

        function drawStars() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            stars.forEach(star => {
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${star.opacity})`;
                ctx.fill();

                star.opacity += star.twinkleSpeed * star.direction;
                if (star.opacity <= 0 || star.opacity >= 1) {
                    star.direction *= -1;
                }
            });
            requestAnimationFrame(drawStars);
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        createStars();
        drawStars();
    </script>

    <style>
        body {
            background-color: var(--unity-gray);
        }

        #floating-koala {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            width: 256px;
            height: auto;
            animation: float 5s ease-in-out infinite;
        }

        @keyframes float {
            0% {
                transform: translateY(-20%) translateX(0);
            }
            50% {
                transform: translateY(-30%) translateX(0px);
            }
            100% {
                transform: translateY(-20%) translateX(0);
            }
        }
    </style>
{{ end }}
